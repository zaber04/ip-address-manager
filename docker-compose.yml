version: '3.8'

services:
  gateway:
    build:
      context: ./server/gateway  # build context
      dockerfile: Dockerfile  # Dockerfile name
    container_name: ip-address-manager-gateway
    ports:
      - "8000:80"
    networks:
      - app_network
    depends_on:
      - authentication
      - ip-handler
      - mysql
    restart: unless-stopped
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
      MYSQL_ROOT_PASSWORD: ""
      DB_CONNECTION: mysql
      DB_HOST: mysql
      DB_PORT: 3306
      DB_DATABASE: ip_handler
      DB_USERNAME: root
    volumes:
      - gateway-data:/var/www/html/storage/gateway


  authentication:
    build:
      context: ./server/authentication
      dockerfile: Dockerfile
    container_name: ip-address-manager-authentication
    ports:
      - "8001:80"
    networks:
      - app_network
    depends_on:
      - mysql
    restart: unless-stopped
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
      MYSQL_ROOT_PASSWORD: ""
      DB_CONNECTION: mysql
      DB_HOST: mysql
      DB_PORT: 3306
      DB_DATABASE: ip_handler
      DB_USERNAME: root
    volumes:
      - authentication-data:/var/www/html/storage/authentication


  ip-handler:
    build:
      context: ./server/ip-handler
      dockerfile: Dockerfile
    container_name: ip-address-manager-ip-handler
    ports:
      - "8002:80"
    networks:
      - app_network
    depends_on:
      - mysql
    restart: unless-stopped
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
      MYSQL_ROOT_PASSWORD: ""
      DB_CONNECTION: mysql
      DB_HOST: mysql
      DB_PORT: 3306
      DB_DATABASE: ip_handler
      DB_USERNAME: root
    volumes:
      - ip-handler-data:/var/www/html/storage/ip-handler


  mysql:
    image: mysql:latest
    container_name: ip-address-manager-mysql
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
      MYSQL_ROOT_PASSWORD: ""
      DB_CONNECTION: mysql
      DB_HOST: mysql
      DB_PORT: 3306
      DB_DATABASE: ip_handler
      DB_USERNAME: root
    ports:
      - "3306:3306"
    networks:
      - app_network
    volumes:
      - mysql-data:/var/lib/mysql


  angular-app:
    build:
      context: ./client
      dockerfile: Dockerfile
    ports:
      - "4200:4200"


networks:
  app_network:
    driver: bridge

volumes:
  ip-handler-data:
    driver: local

  gateway-data:
    driver: local

  authentication-data:
    driver: local

  mysql-data:
    driver: local
